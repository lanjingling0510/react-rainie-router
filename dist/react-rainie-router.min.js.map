{"version":3,"sources":["../src/util.js","../src/Route.jsx","../src/index.js"],"names":["exec","url","route","opts","arguments","length","undefined","EMPTY","reg","c","match","matches","ret","p","split","i","r","decodeURIComponent","slice","join","segmentize","replace","max","Math","charAt","param","flags","plus","indexOf","star","val","map","default","pathRankSort","a","b","aAttr","props","bAttr","diff","rank","path","strip","isPromise","obj","then","setUrl","type","customHistory","history","getCurrentUrl","getCurrentLocation","location","pathname","search","listenBefore","func","push","Promise","all","LISTENRS","routeTo","catch","didRoute","forEach","router","routeFromLink","node","getAttribute","href","target","handleLinkClick","delay","e","persist","_handleLinkClick","button","currentTarget","this","prevent","stopImmediatePropagation","stopPropagation","preventDefault","Route","state","componentWillMount","component","_props2","getComponent","promise","SplitComponent","setState","render","RoutedComponent","_props3","_props","objectWithoutProperties","React","createElement","Component","PropTypes","ROUTERS","addEventListener","Router","_React$Component","call","_this","shouldComponentUpdate","onChange","componentWillUnmount","splice","_didRoute","children","routeElement","childrenElements","Children","toArray","sort","child","cloneElement","_extends","previous","previousUrl","Link","_ref","activeClassName","to","className"],"mappings":"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","file":"react-rainie-router.min.js","sourcesContent":["const EMPTY = {};\n\nexport function exec(url, route, opts = EMPTY) {\n    let reg = /(?:\\?([^#]*))?(#.*)?$/,\n        c = url.match(reg),\n        matches = {},\n        ret;\n    if (c && c[1]) {\n        let p = c[1].split('&');\n        for (let i = 0; i < p.length; i++) {\n            let r = p[i].split('=');\n            matches[decodeURIComponent(r[0])] = decodeURIComponent(r.slice(1).join('='));\n        }\n    }\n    url = segmentize(url.replace(reg, ''));\n    route = segmentize(route || '');\n    let max = Math.max(url.length, route.length);\n    for (let i = 0; i < max; i++) {\n        if (route[i] && route[i].charAt(0) === ':') {\n            let param = route[i].replace(/(^\\:|[+*?]+$)/g, ''),\n                flags = (route[i].match(/[+*?]+$/) || EMPTY)[0] || '',\n                plus = ~flags.indexOf('+'),\n                star = ~flags.indexOf('*'),\n                val = url[i] || '';\n            if (!val && !star && (flags.indexOf('?') < 0 || plus)) {\n                ret = false;\n                break;\n            }\n            matches[param] = decodeURIComponent(val);\n            if (plus || star) {\n                matches[param] = url.slice(i).map(decodeURIComponent).join('/');\n                break;\n            }\n        } else if (route[i] !== url[i]) {\n            ret = false;\n            break;\n        }\n    }\n    if (opts.default !== true && ret === false) return false;\n    return matches;\n}\n\n\nexport function pathRankSort(a, b) {\n    let aAttr = a.props || EMPTY,\n        bAttr = b.props || EMPTY;\n    if (aAttr.default) return 1;\n    if (bAttr.default) return -1;\n    let diff = rank(aAttr.path) - rank(bAttr.path);\n    return diff || (aAttr.path.length - bAttr.path.length);\n}\n\nexport function segmentize(url) {\n    return strip(url).split('/');\n}\n\nexport function rank(url) {\n    return (strip(url).match(/\\/+/g) || '').length;\n}\n\nexport function strip(url) {\n    return url.replace(/(^\\/+|\\/+$)/g, '');\n}\n","import React from 'react';\n\nfunction isPromise(obj) {\n    return !!obj &&\n        (typeof obj === 'object' || typeof obj === 'function') &&\n        typeof obj.then === 'function';\n}\n\n\nclass Route extends React.Component {\n    static PropTypes = {\n        component: React.PropTypes.node,\n        getComponent: React.PropTypes.func,\n    }\n\n    state = {\n        SplitComponent: undefined,\n    }\n\n    componentWillMount() {\n        const { component, getComponent} = this.props;\n        if (!component && getComponent) {\n            const promise = getComponent();\n            if (isPromise(promise)) {\n                promise.then(SplitComponent => {\n                    this.setState({ SplitComponent });\n                });\n            }\n        }\n    }\n\n    render () {\n        const {\n            component: RoutedComponent,\n            getComponent,\n            ..._props,\n        } = this.props;\n\n        const { SplitComponent } = this.state;\n\n\n        if (RoutedComponent)\n            return <RoutedComponent {..._props} />;\n\n        return SplitComponent ?\n            <SplitComponent {..._props} /> : null;\n    }\n}\n\nexport default Route;\n","import React from 'react';\nimport {exec, pathRankSort} from './util';\nimport Route from './Route.jsx';\n\nlet customHistory = null;\n\nconst ROUTERS = [];\nconst EMPTY = {};\nconst LISTENRS = [];\n\nfunction setUrl(url, type = 'push') {\n    if (customHistory && customHistory[type]) {\n        customHistory[type](url);\n    } else if (typeof history !== 'undefined' && history[type + 'State']) {\n        history[type + 'State'](null, null, url);\n    }\n}\n\nfunction getCurrentUrl() {\n    let url;\n    if (customHistory && customHistory.getCurrentLocation) {\n        url = customHistory.getCurrentLocation();\n    } else {\n        url = typeof location !== 'undefined'\n            ? location\n            : EMPTY;\n    }\n    return `${url.pathname || ''}${url.search || ''}`;\n}\n\nfunction listenBefore(func) {\n    LISTENRS.push(func);\n}\n\n\nfunction route(url, replace = false) {\n    return Promise.all(LISTENRS.map(func => func(url)))\n    .then(() => {\n        if (typeof url !== 'string' && url.url) {\n            replace = url.replace;\n            url = url.url;\n        }\n        setUrl(url, replace\n            ? 'replace'\n            : 'push');\n        return routeTo(url);\n    }).catch(() => {});\n}\n\nfunction routeTo(url) {\n    let didRoute = false;\n    ROUTERS.forEach(router => {\n        if (router.routeTo(url) === true) {\n            didRoute = true;\n        }\n    });\n    return didRoute;\n}\n\nfunction routeFromLink(node) {\n    // only valid elements\n    if (!node || !node.getAttribute)\n        return;\n\n    let href = node.getAttribute('href') || node.getAttribute('to'),\n        target = node.getAttribute('target');\n\n    // ignore links with targets and non-path URLs\n    if (!href || !href.match(/^\\//g) || (target && !target.match(/^_?self$/i)))\n        return;\n\n    // attempt to route, if no match simply cede control to browser\n    return route(href);\n}\n\nfunction handleLinkClick(delay) {\n    if (typeof delay === 'number') {\n        return (e) => {\n            prevent(e);\n            // access the event properties in an asynchronous way\n            e.persist();\n            setTimeout(() => _handleLinkClick(e), delay);\n        };\n    }\n\n    return _handleLinkClick;\n}\n\nfunction _handleLinkClick(e) {\n    if (e.button !== 0)\n        return;\n    routeFromLink(e.currentTarget || e.target || this);\n    return prevent(e);\n}\n\nfunction prevent(e) {\n    if (e) {\n        if (e.stopImmediatePropagation)\n            e.stopImmediatePropagation();\n        if (e.stopPropagation)\n            e.stopPropagation();\n        e.preventDefault();\n    }\n    return false;\n}\n\nif (typeof addEventListener === 'function') {\n    addEventListener('popstate', () => routeTo(getCurrentUrl()));\n}\n\nclass Router extends React.Component {\n    constructor(props) {\n        super(props);\n        if (props.history) {\n            customHistory = props.history;\n        }\n\n        this.state = {\n            url: this.props.url || getCurrentUrl()\n        };\n    }\n\n    shouldComponentUpdate(props, state) {\n        return props.url !== this.props.url ||\n            props.onChange !== this.props.onChange ||\n            state.url !== this.state.url;\n    }\n\n    componentWillMount() {\n        ROUTERS.push(this);\n    }\n\n    componentWillUnmount() {\n        ROUTERS.splice(ROUTERS.indexOf(this), 1);\n    }\n\n    routeTo(url) {\n        this._didRoute = false;\n        this.setState({url});\n        return this._didRoute;\n    }\n\n    render() {\n        const {children, onChange} = this.props;\n        const {url} = this.state;\n        let routeElement = null;\n\n        const childrenElements = React.Children\n            .toArray(children)\n            .sort(pathRankSort);\n\n        for (let i = 0; i < childrenElements.length; i++) {\n            let child = childrenElements[i],\n                props = child.props,\n                path = props.path,\n                matches = exec(url, path, props);\n            if (matches) {\n                routeElement = React.cloneElement(\n                    child,\n                    {...child.props, url, matches}\n                );\n\n                this._didRoute = true;\n                break;\n            }\n        }\n\n\n        let previous = this.previousUrl;\n        if (url !== previous) {\n            this.previousUrl = url;\n            if (typeof onChange === 'function') {\n                onChange({ url, previous, router: this });\n            }\n        }\n        return routeElement;\n    }\n}\n\nconst Link = ({\n    children,\n    activeClassName,\n    delay,\n    ...props\n}) => (\n    <a\n        {...props}\n        className={\n            exec(props.href || props.to, getCurrentUrl()) ?\n             `${activeClassName} ${props.className}` : props.className\n         }\n        onClick={handleLinkClick(delay)}>{children}</a>\n);\n\nRouter.listenBefore = listenBefore;\nRouter.route = route;\nRouter.Router = Router;\nRouter.Route = Route;\nRouter.Link = Link;\n\nexport {route, Router, Route, Link, listenBefore};\nexport default Router;\n"]}