{"version":3,"file":null,"sources":["../src/util.js","../src/Route.jsx","../src/index.js"],"sourcesContent":["const EMPTY = {};\n\nexport function exec(url, route, opts = EMPTY) {\n    let reg = /(?:\\?([^#]*))?(#.*)?$/,\n        c = url.match(reg),\n        matches = {},\n        ret;\n    if (c && c[1]) {\n        let p = c[1].split('&');\n        for (let i = 0; i < p.length; i++) {\n            let r = p[i].split('=');\n            matches[decodeURIComponent(r[0])] = decodeURIComponent(r.slice(1).join('='));\n        }\n    }\n    url = segmentize(url.replace(reg, ''));\n    route = segmentize(route || '');\n    let max = Math.max(url.length, route.length);\n    for (let i = 0; i < max; i++) {\n        if (route[i] && route[i].charAt(0) === ':') {\n            let param = route[i].replace(/(^\\:|[+*?]+$)/g, ''),\n                flags = (route[i].match(/[+*?]+$/) || EMPTY)[0] || '',\n                plus = ~flags.indexOf('+'),\n                star = ~flags.indexOf('*'),\n                val = url[i] || '';\n            if (!val && !star && (flags.indexOf('?') < 0 || plus)) {\n                ret = false;\n                break;\n            }\n            matches[param] = decodeURIComponent(val);\n            if (plus || star) {\n                matches[param] = url.slice(i).map(decodeURIComponent).join('/');\n                break;\n            }\n        } else if (route[i] !== url[i]) {\n            ret = false;\n            break;\n        }\n    }\n    if (opts.default !== true && ret === false) return false;\n    return matches;\n}\n\n\nexport function pathRankSort(a, b) {\n    let aAttr = a.props || EMPTY,\n        bAttr = b.props || EMPTY;\n    if (aAttr.default) return 1;\n    if (bAttr.default) return -1;\n    let diff = rank(aAttr.path) - rank(bAttr.path);\n    return diff || (aAttr.path.length - bAttr.path.length);\n}\n\nexport function segmentize(url) {\n    return strip(url).split('/');\n}\n\nexport function rank(url) {\n    return (strip(url).match(/\\/+/g) || '').length;\n}\n\nexport function strip(url) {\n    return url.replace(/(^\\/+|\\/+$)/g, '');\n}\n","import React from 'react';\n\nfunction isPromise(obj) {\n    return !!obj &&\n        (typeof obj === 'object' || typeof obj === 'function') &&\n        typeof obj.then === 'function';\n}\n\n\nclass Route extends React.Component {\n    static PropTypes = {\n        component: React.PropTypes.node,\n        getComponent: React.PropTypes.func,\n    }\n\n    state = {\n        SplitComponent: undefined,\n    }\n\n    componentWillMount() {\n        const { component, getComponent} = this.props;\n        if (!component && getComponent) {\n            const promise = getComponent();\n            if (isPromise(promise)) {\n                promise.then(SplitComponent => {\n                    this.setState({ SplitComponent });\n                });\n            }\n        }\n    }\n\n    render () {\n        const {\n            component: RoutedComponent,\n            getComponent,\n            ..._props,\n        } = this.props;\n\n        const { SplitComponent } = this.state;\n\n\n        if (RoutedComponent)\n            return <RoutedComponent {..._props} />;\n\n        return SplitComponent ?\n            <SplitComponent {..._props} /> : null;\n    }\n}\n\nexport default Route;\n","import React from 'react';\nimport {exec, pathRankSort} from './util';\nimport Route from './Route.jsx';\n\nlet customHistory = null;\n\nconst ROUTERS = [];\nconst EMPTY = {};\nconst LISTENRS = [];\n\nfunction setUrl(url, type = 'push') {\n    if (customHistory && customHistory[type]) {\n        customHistory[type](url);\n    } else if (typeof history !== 'undefined' && history[type + 'State']) {\n        history[type + 'State'](null, null, url);\n    }\n}\n\nfunction getCurrentUrl() {\n    let url;\n    if (customHistory && customHistory.getCurrentLocation) {\n        url = customHistory.getCurrentLocation();\n    } else {\n        url = typeof location !== 'undefined'\n            ? location\n            : EMPTY;\n    }\n    return `${url.pathname || ''}${url.search || ''}`;\n}\n\nfunction listenBefore(func) {\n    LISTENRS.push(func);\n}\n\n\nfunction route(url, replace = false) {\n    return Promise.all(LISTENRS.map(func => func(url)))\n    .then(() => {\n        if (typeof url !== 'string' && url.url) {\n            replace = url.replace;\n            url = url.url;\n        }\n        setUrl(url, replace\n            ? 'replace'\n            : 'push');\n        return routeTo(url);\n    }).catch(() => {});\n}\n\nfunction routeTo(url) {\n    let didRoute = false;\n    ROUTERS.forEach(router => {\n        if (router.routeTo(url) === true) {\n            didRoute = true;\n        }\n    });\n    return didRoute;\n}\n\nfunction routeFromLink(node) {\n    // only valid elements\n    if (!node || !node.getAttribute)\n        return;\n\n    let href = node.getAttribute('href') || node.getAttribute('to'),\n        target = node.getAttribute('target');\n\n    // ignore links with targets and non-path URLs\n    if (!href || !href.match(/^\\//g) || (target && !target.match(/^_?self$/i)))\n        return;\n\n    // attempt to route, if no match simply cede control to browser\n    return route(href);\n}\n\nfunction handleLinkClick(e) {\n    if (e.button !== 0)\n        return;\n    routeFromLink(e.currentTarget || e.target || this);\n    return prevent(e);\n}\n\nfunction prevent(e) {\n    if (e) {\n        if (e.stopImmediatePropagation)\n            e.stopImmediatePropagation();\n        if (e.stopPropagation)\n            e.stopPropagation();\n        e.preventDefault();\n    }\n    return false;\n}\n\nif (typeof addEventListener === 'function') {\n    addEventListener('popstate', () => routeTo(getCurrentUrl()));\n}\n\nclass Router extends React.Component {\n    constructor(props) {\n        super(props);\n        if (props.history) {\n            customHistory = props.history;\n        }\n\n        this.state = {\n            url: this.props.url || getCurrentUrl()\n        };\n    }\n\n    shouldComponentUpdate(props, state) {\n        return props.url !== this.props.url ||\n            props.onChange !== this.props.onChange ||\n            state.url !== this.state.url;\n    }\n\n    componentWillMount() {\n        ROUTERS.push(this);\n    }\n\n    componentWillUnmount() {\n        ROUTERS.splice(ROUTERS.indexOf(this), 1);\n    }\n\n    routeTo(url) {\n        this._didRoute = false;\n        this.setState({url});\n        return this._didRoute;\n    }\n\n    render() {\n        const {children, onChange} = this.props;\n        const {url} = this.state;\n        let routeElement = null;\n\n        const childrenElements = React.Children\n            .toArray(children)\n            .sort(pathRankSort);\n\n        for (let i = 0; i < childrenElements.length; i++) {\n            let child = childrenElements[i],\n                props = child.props,\n                path = props.path,\n                matches = exec(url, path, props);\n            if (matches) {\n                routeElement = React.cloneElement(\n                    child,\n                    {...child.props, url, matches}\n                );\n\n                this._didRoute = true;\n                break;\n            }\n        }\n\n\n        let previous = this.previousUrl;\n        if (url !== previous) {\n            this.previousUrl = url;\n            if (typeof onChange === 'function') {\n                onChange({ url, previous, router: this });\n            }\n        }\n        return routeElement;\n    }\n}\n\nconst Link = ({\n    children,\n    ...props\n}) => (\n    <a {...props} onClick={handleLinkClick}>{children}</a>\n);\n\nRouter.listenBefore = listenBefore;\nRouter.route = route;\nRouter.Router = Router;\nRouter.Route = Route;\nRouter.Link = Link;\n\nexport {route, Router, Route, Link, listenBefore};\nexport default Router;\n"],"names":["EMPTY","exec","url","route","opts","reg","c","match","matches","ret","p","split","i","length","r","decodeURIComponent","slice","join","segmentize","replace","max","Math","charAt","param","flags","plus","indexOf","star","val","map","default","pathRankSort","a","b","aAttr","props","bAttr","diff","rank","path","strip","isPromise","obj","then","Route","state","undefined","componentWillMount","component","getComponent","promise","setState","SplitComponent","render","RoutedComponent","_props","React","Component","PropTypes","node","func","customHistory","ROUTERS","LISTENRS","setUrl","type","history","getCurrentUrl","getCurrentLocation","location","pathname","search","listenBefore","push","Promise","all","routeTo","catch","didRoute","forEach","router","routeFromLink","getAttribute","href","target","handleLinkClick","e","button","currentTarget","prevent","stopImmediatePropagation","stopPropagation","preventDefault","addEventListener","Router","shouldComponentUpdate","onChange","componentWillUnmount","splice","_didRoute","children","routeElement","childrenElements","Children","toArray","sort","child","cloneElement","previous","previousUrl","Link"],"mappings":"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"}